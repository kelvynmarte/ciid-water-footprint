<!DOCTYPE html>
<link href="https://fonts.googleapis.com/css?family=PT+Mono|PT+Sans:400,700" rel="stylesheet">

<style>
.chart {
    width: 100%;
}
.chart > div {
    width: calc(50% - 6px);
    min-height: 1vh;
    float: left;
}
.internal {
    position: relative;
    float: left;
    border-right: 0px solid #FFF; 
}
.internal:after {
    display: blocK;
    background-color: #FFF;
    opacity: 0.3;
    width: 4px;
    height: 100vh;
    position: absolute;
    content: '';
    right: -2px;
}

.chart > div > div {
  font: 10px sans-serif;
  background-color: steelblue;
  text-align: right;
  padding: 0px;
  margin-bottom: 0px;
  color: black;
}
.internal > div{
    float: right;
    clear: both;
}

.internal > div:hover {
}

</style>
<body>
<div class="chart">
</div>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
    var regions = ["OCEANIA","SUB SAHARAN AFRICA","NORTHERN AFRICA","ASIA","NEAR EAST","EASTERN EUROPE","WESTERN EUROPE", "BALTICS","C.W. OF IND. STATES", "LATIN AMERICA", "NORTHERN AMERICA"  ];
    // var regionColors = ["#8081b9", "#8cb9da", "#7bc1d8", "#003845", "#588ca4", "#145b9b", "#67aadf", "#61bae4", "#a7dea", "#01a4bf", "#45a889"];
    //var regionColors = ["#8f57a2", "#fcb71e", "#f58023", "#bdd549", "#9cc841", "#9ddaec", "#1aabd8", "#3d81c2", "#244d74", "#fae83e", "#46bea2"];
        var regionColors = ["#0a0d4f", "#13338e", "#1b63a7 ", "#5b85d4", "#89b6e4 ", "#c0eaff", "#90d7eb", "#70b0c5", "#0195ae", "#446c7f", "#2a434e"];

    var width = window.innerWidth - 40;
    var height = window.innerHeight - 40;
    var dataDisplayRange = width - 600
    var svg = d3.select(".chart").append("svg").attr("width", width).attr("height", height);

    d3.csv("waterFootprint.csv", function(error, data) {
        // Convert strings to numbers.
        data.forEach(function(d) {
            d.InternalTotal = +d.InternalTotal;
            d.ExternalTotal = +d.ExternalTotal;
            d.InternalTotalCap = +d.InternalTotalCap;
            d.ExternalTotalCap = +d.ExternalTotalCap;
            d.TotalCap = +d.TotalCap;
            d.Country = d.Country.trim();
        });


        // Sort by total cap 
        /*data.sort(function(a,b) { 
            return a.TotalCap - b.TotalCap; 
        });*/

        // Sort by region
        data.sort(function(a,b) { 
            return regions.indexOf(a.Region) - regions.indexOf(b.Region); 
        });


        var maxOne = d3.max(data, function(d) { return Math.max(d.ExternalTotalCap, d.InternalTotalCap); });

        var xScale = d3.scaleLinear()
        .domain([0, maxOne])
        .range([0, dataDisplayRange/2]);
        var yScale = d3.scaleLinear()
        .domain([0, data.length])
        .range([0, height]);

        var barHeight = Math.floor((height / data.length));
        console.log(barHeight, "barHeigt")

        svg
        .selectAll("rect")
        .data(data)
        .enter()
        .append("rect")
        .attr("width", function(d) { 
            return xScale(d.TotalCap); })
        .attr("height", function(d,i) { 
            return  yScale(1); })
        .attr("y", function(d,i){
            return yScale(i);
        })
        .attr("x", function(d,i){
            return  ( width / 2 ) - xScale(d.InternalTotalCap);
        })
        .attr("fill", function(d) { 
            return  regionColors[regions.indexOf(d.Region)]; 
        })
        .on("mouseover", function(d, i) { 
            console.log(d, "mouseover");
            console.log(i, "mouseover");

             // Add interactivity
            // Use D3 to select element, change color and size
            // d3.select(this).attr(
            //   "height", yScale(3)
            // );
            d3.select(this).attr(
              "fill", "#EDAE00"
            );

            svg.append("rect")
            .attr("id",  "r" + i)
            .attr("x",  ( width / 2 ) -  (dataDisplayRange / 2))
            .attr("y",  yScale(i) + (yScale(1)/2) - 0.5 )
            .attr("height", 1)
            .attr("width", ( dataDisplayRange / 2) - xScale(d.InternalTotalCap ) - 10)
            .attr("fill", "#000000")
            .style("opacity", 0.2);

            svg.append("text")
            .attr("id",  "t" + i)
            .attr("x",  ( width / 2 ) -  (dataDisplayRange / 2) - 30)
            .attr("y",  yScale(i) +5 )
            .attr("font-family", "'PT Mono', monospace")
            .attr("font-size", "13px")
            .text( Math.round(xScale(d.InternalTotalCap)));
          })
        .on("mouseout", function(d, i) {  // Add interactivity
            d3.select(this).attr(
              "height", yScale(1)
            );
            d3.select(this).attr(
              "fill", regionColors[regions.indexOf(d.Region)]
            );
            d3.select("#t" + i).remove();
            d3.select("#r" + i).remove();

          })
        .append("svg:title")
        .text(function(d) { return d.Country; })
        // .exit().exit()
        // .append("text")
        // .attr("x", function(d) { xScale(d.TotalCap); })
        // .attr("y", function(d,i) { yScale(i); })
        // .text( "TEST")
        // .attr("font-family", "sans-serif")
        // .attr("font-size", "20px")
        // .attr("fill", "red");

        svg.append("rect")
            .attr("x", (width/2) - 1)
            .attr("y", 0)
            .attr("height", height)
            .attr("width", 2)
            .attr("fill", "#FFFFFF")
            .style("opacity", 0.3);


            //.text(function(d) { return d.Country; });

    // d3.select(".internal")
    // .selectAll("div")
    //     .data(data)
    // .enter().append("div")
    //     .style("width", function(d) { 
    //         console.log(d);
    //         return x(d.InternalTotalCap) + "px"; })
    //     .style("height", function(d) { 
    //         return  barHeight + "px"; })
    //     .style("background-color", function(d) { 
    //         return  regionColors[regions.indexOf(d.Region)]; });
    //         //.text(function(d) { return d.Country; });

    //     d3.select(".external")
    // .selectAll("div")
    //     .data(data)
    // .enter().append("div")
    //     .style("width", function(d) { 
    //         console.log(d);
    //         return x(d.ExternalTotalCap) + "px"; })
    //     .style("height", function(d) { 
    //         return  barHeight + "px"; })
    //     .style("background-color", function(d) { 
    //         console.log(d.Region + ":" + regions.indexOf(d.Region) + ":" + regionColors[regions.indexOf(d.Region)], "colors");
    //         return  regionColors[regions.indexOf(d.Region)]; });
    //      // .text(function(d) { return d.Country; });
    });
</script>
</body>